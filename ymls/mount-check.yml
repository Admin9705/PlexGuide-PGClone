#!/bin/bash
#
# Title:      PGBlitz (Reference Title File)
# Author(s):  Admin9705 - Deiteq
# URL:        https://pgblitz.com - http://github.pgblitz.com
# GNU:        General Public License v3.0
################################################################################
---
- name: Check if gdrive is active
  shell: systemctl is-active gdrive
  ignore_errors: yes
  changed_when: false
  register: service_gdrive_status
  
- name: Check status of gdrive
  fail:
    msg: gdrive has failed and is not running. Your apps are stopped to prevent data loss.
  when: service_gdrive_status.rc != 0

- name: Check if tdrive is active
  shell: systemctl is-active tdrive
  changed_when: false
  register: service_tdrive_status
- name: Check status of tdrive
  fail:
    msg: |
      tdrive has failed and is not running. Your apps are stopped to prevent data loss. Please check the logs in PGUI for more info.
  when: (service_tdrive_status.rc != 0 and (transport == "bu" or transport == "be")

- name: Check if tcrypt is active
  shell: systemctl is-active tcrypt
  ignore_errors: yes
  changed_when: false
  register: service_tcrypt_status
- name: Check status of tcrypt
  fail:
    msg: tcrypt has failed and is not running. Your apps are stopped to prevent data loss.
  when: (service_tcrypt_status.rc != 0) and (transport == "be")

- name: Check if gcrypt is active
  shell: systemctl is-active gcrypt
  ignore_errors: yes
  changed_when: false
  register: service_gcrypt_status
- name: Check status of gcrypt
  fail:
    msg: gcrypt has failed and is not running. Your apps are stopped to prevent data loss.
  when: (service_gcrypt_status.rc != 0) and (transport == "me" or transport == "be")

- name: Check if pgunion is active
  shell: systemctl is-active pgunion
  ignore_errors: yes
  changed_when: false
  register: service_pgunion_status
- name: Check status of pgunion
  fail:
    msg: pgunion has failed and is not running. Your apps are stopped to prevent data loss.
  when: service_pgunion_status.rc != 0
